<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avoda Wallet</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: white;
      padding: 20px;
      max-width: 400px;
      margin: auto;
      border-radius: 10px;
    }
    .light-mode {
      background: #f0f0f0;
      color: #121212;
    }
    input, button, select {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      border: none;
    }
    button {
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    #qrcode canvas {
      width: 100%;
    }
    .history {
      margin-top: 15px;
    }
  </style>
</head><body>
  <h2>Avoda Wallet ðŸ’¼</h2>  <select id="network" onchange="initWeb3(this.value)">
    <option value="https://mainnet.infura.io/v3/">Ethereum</option>
    <option value="https://bsc-dataseed.binance.org/">Binance Smart Chain</option>
    <option value="https://polygon-rpc.com/">Polygon</option>
  </select><button onclick="createWallet()">ðŸ†• Create Wallet</button> <input id="importPK" placeholder="Private Key"> <button onclick="importWallet()">ðŸ“¥ Import Wallet</button>

  <input id="password" type="password" placeholder="Password">
  <button onclick="saveWalletEncrypted()">ðŸ”’ Save</button>  <p>Address: <span id="address">-</span></p>
  <p>Balance: <span id="balance">-</span></p>
  <p id="usd">USD Value: -</p>  <div id="qrcode"></div>  <input id="to" placeholder="To (address or ENS)">
  <input id="amount" placeholder="Amount">
  <button onclick="estimateGas()">â›½ Estimate Gas</button>
  <button onclick="sendTransaction()">ðŸ“¤ Send</button><button onclick="connectMetaMask()">ðŸ¦Š Connect MetaMask</button> <button onclick="downloadEncryptedKey()">ðŸ’¾ Backup Wallet</button> <button id="themeToggle">ðŸŒ“ Toggle Theme</button>

  <div class="history">
    <h4>History</h4>
    <ul id="history"></ul>
  </div>  <script>
    let web3, account;
    const encryptedPKKey = "avoda_encrypted_key";

    function initWeb3(network) {
      web3 = new Web3(new Web3.providers.HttpProvider(network));
    }

    function getSymbolFromNetwork() {
      const url = document.getElementById("network").value;
      if (url.includes("bsc")) return "BNB";
      if (url.includes("polygon")) return "MATIC";
      return "ETH";
    }

    async function createWallet() {
      account = web3.eth.accounts.create();
      displayWallet();
    }

    function importWallet() {
      account = web3.eth.accounts.privateKeyToAccount(document.getElementById("importPK").value);
      displayWallet();
    }

    function displayWallet() {
      document.getElementById("address").innerText = account.address;
      QRCode.toCanvas(document.getElementById("qrcode"), account.address);
      getBalance();
    }

    async function getBalance() {
      const balance = await web3.eth.getBalance(account.address);
      const symbol = getSymbolFromNetwork();
      const eth = web3.utils.fromWei(balance, "ether");
      document.getElementById("balance").innerText = `${eth} ${symbol}`;

      fetch(`https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd`)
        .then(res => res.json())
        .then(data => {
          const usdValue = (parseFloat(eth) * data.ethereum.usd).toFixed(2);
          document.getElementById("usd").innerText = `USD Value: ~$${usdValue}`;
        });
    }

    function saveWalletEncrypted() {
      const pass = document.getElementById("password").value;
      if (!account) return alert("No wallet");
      const encrypted = CryptoJS.AES.encrypt(account.privateKey, pass).toString();
      localStorage.setItem(encryptedPKKey, encrypted);
      alert("Saved Encrypted Wallet âœ…");
    }

    function loadWalletEncrypted() {
      const encrypted = localStorage.getItem(encryptedPKKey);
      if (!encrypted) return;
      const pass = prompt("Password to load wallet:");
      try {
        const decrypted = CryptoJS.AES.decrypt(encrypted, pass).toString(CryptoJS.enc.Utf8);
        account = web3.eth.accounts.privateKeyToAccount(decrypted);
        displayWallet();
      } catch (e) {
        alert("Failed to decrypt wallet");
      }
    }

    async function estimateGas() {
      const to = document.getElementById("to").value;
      const value = document.getElementById("amount").value;
      const valueWei = web3.utils.toWei(value, "ether");
      const gas = await web3.eth.estimateGas({ from: account.address, to: to, value: valueWei });
      alert(`Estimated Gas: ${gas}`);
    }

    async function resolveENS(name) {
      try {
        return await web3.eth.ens.getAddress(name);
      } catch {
        return null;
      }
    }

    async function sendTransaction() {
      const toInput = document.getElementById("to").value;
      const to = toInput.endsWith(".eth") ? await resolveENS(toInput) : toInput;
      const value = web3.utils.toWei(document.getElementById("amount").value, "ether");
      const tx = {
        from: account.address,
        to,
        value,
        gas: 21000
      };
      const signed = await web3.eth.accounts.signTransaction(tx, account.privateKey);
      const receipt = await web3.eth.sendSignedTransaction(signed.rawTransaction);
      document.getElementById("history").innerHTML += `<li>Tx: ${receipt.transactionHash}</li>`;
      getBalance();
    }

    async function connectMetaMask() {
      if (window.ethereum) {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        web3 = new Web3(window.ethereum);
        const accounts = await web3.eth.getAccounts();
        account = { address: accounts[0] };
        displayWallet();
      } else {
        alert("MetaMask not found");
      }
    }

    function downloadEncryptedKey() {
      const encrypted = localStorage.getItem(encryptedPKKey);
      const blob = new Blob([encrypted], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "avoda_wallet_backup.txt";
      a.click();
    }

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      localStorage.setItem("avoda_theme", document.body.classList.contains("light-mode") ? "light" : "dark");
    });

    window.onload = () => {
      initWeb3(document.getElementById("network").value);
      loadWalletEncrypted();
      if (localStorage.getItem("avoda_theme") === "light") {
        document.body.classList.add("light-mode");
      }
    }
  </script></body></html>
